#!/usr/bin/env bash

TS=$(date +"%s")
DIR="/tmp/backup-to-${TS}"
ZIP="/tmp/backup-to-${TS}.zip"

REMOTE_SERVER=$1
REMOTE_DIR=${2:-"~"}
if [ -z "$REMOTE_SERVER" ]; then
	echo "You need to specify a remote server!"
	exit 1
fi

mkdir -v $DIR

# Backup List
cp -R $HOME/.ssh $DIR
cp -R $HOME/.local $DIR
cp -R $HOME/.gitconfig* $DIR
cp -R $HOME/.hyper* $DIR
# Local Extras
[[ -f "$HOME/.local/backup-to" ]] && $HOME/.local/backup-to $DIR

CUR=$PWD
cd $DIR
zip -r --quiet $ZIP .
cd $CUR

rsync --progress $ZIP ${REMOTE_SERVER}:${REMOTE_DIR}/

rm -f $ZIP
rm -rf $DIR
echo "removed directory '$DIR'"

echo "=== Backup Completed ==="
